<%= include_gon(namespace: 'simulation', init: true) %>
<%= javascript_include_tag "simulator/manifest.js" %>

<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div id="simulation-chart" style="min-width: 100%; height: 240px; margin 0 auto;"></div>
    </div>
  </div>

  <div class="row">

    <div class="col-3">
      <h2>Player Options</h2>
      <form>
        <div class="form-group">
          <label>Job</label>
          <select data-bind="options: jobs, optionsText: 'name', value: selectedJob" class="form-control"></select>
        </div>

        <div class="form-group">
          <label>Player Name</label>
          <input type="text" class="form-control" data-bind="value: playerName"></input>
        </div>

        <button class="btn btn-outline-primary" data-bind="click: savePlayerScript">Save Script</button>
      </form>

      <h2>Actions</h2>
      <div data-bind="with: selectedJob">
        <div data-bind="foreach: { data: actions, as: 'action' }">
          <a href="" data-bind="click: $root.addActionToRoutine">
            <img data-bind="attr: { src: action.imagePath }">
          </a>
        </div>
      </div>

    </div>

    <div class="col-9">
      <h2>Combat Simulator</h2>
      <table class="table table-sm">
        <thead>
          <tr>
            <th>Seq.</th>
            <th>Time</th>
            <th>Action</th>
            <th>Effects</th>
            <th>Potency</th>
            <th>Self-multipliers</th>
            <th>Target Multipliers</th>
            <th>Crit Chance</th>
            <th>Crit Variance</th>
            <th>Clear</th>
          </tr>
        </thead>
        <tbody data-bind="foreach: { data: routine.slots, as: 'slot' }">
          <tr>
            <td data-bind="text: slot.id"></td>
            <!-- ko with: slot.viewer -->
            <td data-bind="text: encounterTime"></td>
            <td data-bind="text: name"></td>
            <td data-bind="foreach: { data: effects, as: 'action' }">
              <img src="" data-bind="attr: { src: action.imagePath }" style="width: 24px; height: 24px;">
              <sub data-bind="text: duration"></sub>
            </td>
            <td data-bind="text: effectivePotency"></td>
            <td data-bind="text: multiplier"></td>
            <td data-bind="text: targetMultiplier"></td>
            <td></td>
            <td></td>
            <!-- /ko -->
            <td>
              <a href="#" data-bind="click: slot.clear">Result<a> |
              <a href="#" data-bind="click: $root.removeSlotFromRoutine">Slot<a>
            </td>
          </tr>
        </tbody>
      </table>

    </div>
  </div>

  <div class="row pt-5">
    <div class="col-12">

    </div>
  </div>

  <div class="row">
    <div class="col-12 pt-5">
      <%= link_to "Back", dashboard_index_path, class: 'btn btn-secondary' %>
    </div>
  </div>

</div>
