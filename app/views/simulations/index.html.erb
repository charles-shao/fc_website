<%= include_gon(namespace: 'simulation', init: true) %>
<%= javascript_include_tag "simulator/manifest.js" %>

<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div id="simulation-chart" style="min-width: 100%; height: 480px; margin 0 auto;"></div>
    </div>
  </div>

  <div class="row">
    <div class="col-3">
      <h2>Options</h2>
      <label>Job</label>
      <select data-bind="options: jobs, optionsText: 'name', value: selectedJob" class="form-control">
      </select>
    </div>
    <div class="col-9">
      <h2>Rotation Simulator</h2>
      <table class="table table-sm">
        <thead class="thead-default">
          <th>Seq.</th>
          <th>Time</th>
          <th>Action</th>
          <th>Effects</th>
          <th>Potency</th>
          <th>Self-multipliers</th>
          <th>Target Multipliers</th>
          <th>Crit Chance</th>
          <th>Crit Variance</th>
          <th>Total Potency</th>
          <th></th>
        </thead>
        <tbody data-bind="foreach: { data: timeline.actionsObserved, as: 'actionObserver' }">
          <tr>
            <td data-bind="text: actionObserver.sequence"></td>
            <td data-bind="text: actionObserver.timeSinceEncounter"></td>
            <td data-bind="text: actionObserver.name"></td>
            <td data-bind="foreach: { data: actionObserver.actionEffectsActive, as: 'effect' }">
              <img src="" alt="" data-bind="attr: { src: effect.action.type.imagePath }" style="width: 24px; height: 24px;">
              <sub data-bind="text: effect.displayDuration"></sub>
            </td>
            <td data-bind="text: actionObserver.potency"></td>
            <td data-bind="text: actionObserver.multiplierText"></td>
            <td>1.00</td>
            <td data-bind="text: actionObserver.criticalChance"></td>
            <td data-bind="text: actionObserver.criticalVariance"></td>
            <td data-bind="text: actionObserver.totalPotency"></td>
            <td>
              <a href="#" data-bind="click: $root.removeActionFromQueue"><i class="fa fa-trash" aria-hidden="true"></i></a>
            </td>
          </tr>
        </tbody>
      </table>

    </div>
  </div>

  <div class="row pt-5">
    <div class="col-12">
      <h2>Actions</h2>

      <div data-bind="with: selectedJob">
        <div data-bind="foreach: { data: actions, as: 'action' }">
          <a href="#">
            <img data-bind="attr: { src: action.imagePath }">
          </a>
        </div>
      </div>

    </div>
  </div>

  <div class="row">
    <div class="col-12 pt-5">
      <%= link_to "Back", dashboard_index_path, class: 'btn btn-secondary' %>
    </div>
  </div>

</div>
